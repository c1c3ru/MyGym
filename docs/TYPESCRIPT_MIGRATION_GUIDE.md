# Guia de Migra√ß√£o para Interfaces TypeScript

## üìã Vis√£o Geral

Este documento descreve a migra√ß√£o completa das **classes JavaScript legacy** para **interfaces TypeScript** no projeto MyGym, seguindo os princ√≠pios da Clean Architecture.

## ‚úÖ Status da Migra√ß√£o

### FASE 1: Remo√ß√£o de Classes Legacy ‚úÖ COMPLETO

**Arquivos Removidos:**
- ‚ùå `/src/domain/entities/AuthSession.js` (classe sem `userProfile`)
- ‚ùå `/src/domain/entities/User.js` (classe com `uid` ao inv√©s de `id`)
- ‚ùå `/src/domain/entities/Claims.js` (classe ao inv√©s de interface)

**Arquivos Movidos para Backup:**
- ‚úÖ Use cases legacy (4 arquivos) ‚Üí `/backup/domain_usecases_legacy/`
- ‚úÖ Data sources legacy (2 arquivos) ‚Üí `/backup/data_legacy/`
- ‚úÖ DI Container legacy (1 arquivo) ‚Üí `/backup/data_legacy/`
- ‚úÖ Hooks legacy (1 arquivo) ‚Üí `/backup/data_legacy/`

### FASE 2: Corre√ß√£o de Imports ‚úÖ COMPLETO

**Use Cases Corrigidos (6 arquivos):**
1. ‚úÖ `SignInWithEmail.ts` - AuthSession de `@domain/entities` ‚Üí `../entities`
2. ‚úÖ `SignUpWithEmail.ts` - AuthSession e UserType de `@domain/entities` ‚Üí `../entities`
3. ‚úÖ `GetUserSession.ts` - AuthSession e User de `@domain/entities` ‚Üí `../entities`
4. ‚úÖ `RefreshUserToken.ts` - User e Claims de `@domain/entities` ‚Üí `../entities`
5. ‚úÖ `SendPasswordResetEmail.ts` - AuthRepository de `@domain/repositories` ‚Üí `../repositories`
6. ‚úÖ `SignOut.ts` - AuthRepository de `@domain/repositories` ‚Üí `../repositories`

**Arquivos de √çndice Atualizados:**
- ‚úÖ `/src/domain/entities/index.ts` - Removidas exporta√ß√µes de User, AuthSession, Claims

### FASE 3: Adapta√ß√£o de C√≥digo JavaScript ‚úÖ COMPLETO

**Script Criado:**
- ‚úÖ `/scripts/adapt-to-typescript-interfaces.js`

**Adapta√ß√µes Autom√°ticas Aplicadas (33 arquivos):**

| Padr√£o Legacy | Padr√£o TypeScript | Arquivos Afetados |
|---------------|-------------------|-------------------|
| `user.uid` | `user.id` | 33 arquivos |
| `.isAdmin()` | `.userType === 'admin'` | 0 (n√£o usado) |
| `.isInstructor()` | `.userType === 'instructor'` | 0 (n√£o usado) |
| `.isStudent()` | `.userType === 'student'` | 0 (n√£o usado) |
| `.toObject()` | (removido) | 0 (n√£o usado) |
| `.toJSON()` | (removido) | 0 (n√£o usado) |

**Arquivos Adaptados:**
- ‚úÖ CheckInButton.js (2 mudan√ßas)
- ‚úÖ PaymentDueDateEditor.js (2 mudan√ßas)
- ‚úÖ StudentDisassociationDialog.js (5 mudan√ßas)
- ‚úÖ AuthContext.js (3 mudan√ßas)
- ‚úÖ NotificationContext.js (7 mudan√ßas)
- ‚úÖ useAnalytics.js (1 mudan√ßa)
- ‚úÖ useAuthMigration.js (3 mudan√ßas)
- ‚úÖ CheckIn.js (14 mudan√ßas)
- ‚úÖ InstructorClasses.js (10 mudan√ßas)
- ‚úÖ InstructorDashboard.js (4 mudan√ßas)
- ‚úÖ InstructorStudents.js (9 mudan√ßas)
- ‚úÖ Relatorios.js (6 mudan√ßas)
- ‚úÖ ScheduleClassesScreen.js (3 mudan√ßas)
- ‚úÖ StudentDashboard.js (8 mudan√ßas)
- ‚úÖ E mais 19 arquivos...

## üìö Interfaces TypeScript Corretas

### User (Interface)

```typescript
// Localiza√ß√£o: /src/domain/auth/entities.ts
export interface User {
  readonly id: string;                    // ‚úÖ id (n√£o uid)
  readonly email: string;
  readonly emailVerified: boolean;
  readonly displayName?: string;
  readonly photoURL?: string;
  readonly phoneNumber?: string;
  readonly providerId?: string;
  readonly isAnonymous?: boolean;
  readonly metadata?: {
    readonly creationTime?: string;
    readonly lastSignInTime?: string;
  };
  readonly providerData?: ReadonlyArray<{
    readonly uid: string;
    readonly email?: string;
    readonly displayName?: string;
    readonly photoURL?: string;
    readonly providerId: string;
    readonly phoneNumber?: string;
  }>;
  readonly refreshToken?: string;
  readonly tenantId?: string;
  readonly createdAt: Date;
  readonly lastSignInAt?: Date;
  readonly updatedAt?: Date;
}
```

### UserProfile (Interface)

```typescript
// Localiza√ß√£o: /src/domain/auth/entities.ts
export interface UserProfile {
  readonly id: string;
  readonly name: string;
  readonly email: string;
  readonly phone?: string;
  readonly userType: UserType;            // ‚úÖ 'student' | 'instructor' | 'admin'
  readonly academiaId?: string;
  readonly isActive: boolean;
  readonly profileCompleted: boolean;
  readonly photoURL?: string;
  readonly dateOfBirth?: Date;
  readonly gender?: 'male' | 'female' | 'other' | 'prefer_not_to_say';
  readonly address?: {
    readonly street?: string;
    readonly city?: string;
    readonly state?: string;
    readonly zipCode?: string;
    readonly country?: string;
  };
  readonly emergencyContact?: {
    readonly name: string;
    readonly phone: string;
    readonly relationship: string;
  };
  readonly medicalInfo?: {
    readonly allergies?: string[];
    readonly medications?: string[];
    readonly conditions?: string[];
    readonly notes?: string;
  };
  readonly currentGraduation?: string;
  readonly graduations: string[];
  readonly classIds: string[];
  readonly instructorIds?: string[];
  readonly preferences?: {
    readonly notifications: {
      readonly email: boolean;
      readonly push: boolean;
      readonly sms: boolean;
    };
    readonly language: string;
    readonly timezone: string;
  };
  readonly stats?: {
    readonly totalClasses: number;
    readonly totalHours: number;
    readonly streak: number;
    readonly lastActivity?: Date;
  };
  readonly createdAt: Date;
  readonly updatedAt: Date;
  readonly lastLoginAt?: Date;
}
```

### AuthSession (Interface)

```typescript
// Localiza√ß√£o: /src/domain/auth/entities.ts
export interface AuthSession {
  readonly user: User;
  readonly userProfile: UserProfile;      // ‚úÖ Inclui userProfile
  readonly claims: Claims;
  readonly academia?: Academia;
}
```

### Claims (Interface)

```typescript
// Localiza√ß√£o: /src/domain/auth/entities.ts
export interface Claims {
  readonly role: string;
  readonly academiaId?: string;
  readonly permissions?: string[];
  readonly customClaims?: Record<string, any>;
  readonly issuedAt?: Date;
  readonly expiresAt?: Date;
  readonly issuer?: string;
  readonly audience?: string;
  readonly subject?: string;
  readonly scopes?: string[];
  readonly metadata?: Record<string, any>;
}
```

## üîÑ Como Usar as Interfaces

### ‚úÖ CORRETO - Criar objetos com interfaces

```typescript
// Criar User
const user: User = {
  id: firebaseUser.uid,
  email: firebaseUser.email || '',
  emailVerified: firebaseUser.emailVerified,
  createdAt: new Date(),
  lastSignInAt: new Date()
};

// Criar UserProfile
const userProfile: UserProfile = {
  id: userId,
  name: 'Jo√£o Silva',
  email: 'joao@example.com',
  userType: 'student',
  isActive: true,
  profileCompleted: true,
  graduations: [],
  classIds: [],
  createdAt: new Date(),
  updatedAt: new Date()
};

// Criar AuthSession
const session: AuthSession = {
  user,
  userProfile,
  claims: {
    role: 'student',
    academiaId: 'abc123'
  },
  academia: {
    id: 'abc123',
    name: 'Academia XYZ',
    isActive: true
  }
};
```

### ‚ùå INCORRETO - Usar classes legacy

```javascript
// ‚ùå N√ÉO FAZER ISSO
const user = new User(uid, email, name, ...);
const session = new AuthSession({ user, token, ... });

// ‚ùå N√ÉO FAZER ISSO
if (user.isAdmin()) { ... }
if (user.isInstructor()) { ... }

// ‚ùå N√ÉO FAZER ISSO
const obj = user.toObject();
const json = user.toJSON();
```

### ‚úÖ CORRETO - Verificar tipo de usu√°rio

```typescript
// ‚úÖ Usar userProfile.userType
if (userProfile.userType === 'admin') {
  // L√≥gica de admin
}

if (userProfile.userType === 'instructor') {
  // L√≥gica de instrutor
}

if (userProfile.userType === 'student') {
  // L√≥gica de aluno
}
```

### ‚úÖ CORRETO - Acessar propriedades

```typescript
// ‚úÖ user.id (n√£o user.uid)
const userId = user.id;

// ‚úÖ Acessar diretamente (n√£o precisa de .toObject())
const userData = {
  id: user.id,
  email: user.email,
  name: userProfile.name
};
```

## üõ†Ô∏è Mappers (Data Layer)

Os mappers convertem dados do Firebase para as interfaces TypeScript:

```typescript
// /src/data/auth/mappers.ts
export class AuthMappers {
  static toDomainUser(firebaseUser: FirebaseUserData): User {
    return {
      id: firebaseUser.uid,              // ‚úÖ Firebase uid ‚Üí Domain id
      email: firebaseUser.email || '',
      emailVerified: firebaseUser.emailVerified,
      createdAt: new Date(firebaseUser.metadata?.creationTime || Date.now()),
      lastSignInAt: firebaseUser.metadata?.lastSignInTime 
        ? new Date(firebaseUser.metadata.lastSignInTime)
        : undefined
    };
  }

  static toDomainUserProfile(firestoreData: FirestoreUserProfileData): UserProfile {
    return {
      id: firestoreData.id,
      name: firestoreData.name,
      email: firestoreData.email,
      phone: firestoreData.phone,
      userType: firestoreData.userType,
      academiaId: firestoreData.academiaId,
      isActive: firestoreData.isActive,
      profileCompleted: firestoreData.profileCompleted ?? false,
      currentGraduation: firestoreData.currentGraduation,
      graduations: firestoreData.graduations || [],
      classIds: firestoreData.classIds || [],
      createdAt: this.toDate(firestoreData.createdAt),
      updatedAt: this.toDate(firestoreData.updatedAt)
    };
  }
}
```

## üìù Checklist de Migra√ß√£o

### Para Novos Arquivos TypeScript

- [ ] Importar interfaces de `@domain/auth/entities`
- [ ] Usar `user.id` ao inv√©s de `user.uid`
- [ ] Usar `userProfile.userType` ao inv√©s de m√©todos `.isAdmin()`
- [ ] Criar objetos literais ao inv√©s de `new Class()`
- [ ] N√£o usar `.toObject()` ou `.toJSON()`

### Para Arquivos JavaScript Existentes

- [ ] Executar script de adapta√ß√£o: `node scripts/adapt-to-typescript-interfaces.js`
- [ ] Verificar se `user.uid` foi substitu√≠do por `user.id`
- [ ] Testar funcionalidades afetadas
- [ ] Remover imports de classes legacy

## üîç Verifica√ß√£o

### Verificar se h√° classes legacy sendo usadas:

```bash
# Procurar por imports incorretos
grep -r "from '@domain/entities'" src/

# Procurar por uso de .uid
grep -r "\.uid" src/presentation/

# Procurar por m√©todos legacy
grep -r "\.isAdmin()\|\.isInstructor()\|\.isStudent()" src/
```

### Executar testes:

```bash
# Testes TypeScript
npx tsc --noEmit

# Testes Jest
npm test
```

## üìä Benef√≠cios da Migra√ß√£o

‚úÖ **Type Safety**: TypeScript garante tipos corretos em tempo de compila√ß√£o
‚úÖ **Imutabilidade**: Interfaces com `readonly` previnem muta√ß√µes acidentais
‚úÖ **Clean Architecture**: Separa√ß√£o clara entre domain, data e presentation
‚úÖ **Manutenibilidade**: C√≥digo mais limpo e f√°cil de entender
‚úÖ **Escalabilidade**: Interfaces podem ser estendidas facilmente
‚úÖ **Performance**: Objetos literais s√£o mais leves que inst√¢ncias de classes
‚úÖ **Consist√™ncia**: Uma √∫nica fonte de verdade para tipos

## üöÄ Pr√≥ximos Passos

1. ‚úÖ Remover classes legacy
2. ‚úÖ Corrigir imports nos use cases
3. ‚úÖ Adaptar c√≥digo JavaScript
4. ‚è≥ Converter arquivos JavaScript para TypeScript (opcional)
5. ‚è≥ Adicionar testes unit√°rios para interfaces
6. ‚è≥ Documentar padr√µes de uso

## üìö Refer√™ncias

- [TypeScript Handbook - Interfaces](https://www.typescriptlang.org/docs/handbook/interfaces.html)
- [Clean Architecture - Robert C. Martin](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [Domain-Driven Design](https://martinfowler.com/bliki/DomainDrivenDesign.html)

---

**√öltima atualiza√ß√£o:** 2025-10-01
**Status:** ‚úÖ Migra√ß√£o Completa
